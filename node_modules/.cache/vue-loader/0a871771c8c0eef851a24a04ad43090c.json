{"remainingRequest":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/steven/workspace/casting-agency-frontend/src/components/movies/MovieSingle.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/steven/workspace/casting-agency-frontend/src/components/movies/MovieSingle.vue","mtime":1654080876329},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-plugin-babel/node_modules/cache-loader/dist/cjs.js","mtime":1618407608009},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-plugin-babel/node_modules/thread-loader/dist/cjs.js","mtime":1618407608051},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/babel-loader/lib/index.js","mtime":1650889791270},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":1618407608009},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1634219578329}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IEJGb3JtLCBCRm9ybURhdGVwaWNrZXIsIEJGb3JtSW5wdXQgfSBmcm9tICJib290c3RyYXAtdnVlIjsKaW1wb3J0IHsgQXBpU2VydmljZSB9IGZyb20gIkAvYXBpIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCB7IExvYWRpbmdBbmltYXRpb24gfSBmcm9tICJAL2NvbXBvbmVudHMvc2hhcmVkIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiTW92aWVTaW5nbGUiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBtb3ZpZURhdGE6IG51bGwsCiAgICAgIGFjdG9yczogW10sCiAgICAgIGlzTG9hZGluZzogdHJ1ZSwKICAgICAgZXJyb3I6IG51bGwsCiAgICAgIHNlbGVjdGVkQWN0b3JzOiBbXSwKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgaWYgKHRoaXMuJHJvdXRlLm5hbWUuc3RhcnRzV2l0aCgiYXBwX21vdmllc19uZXciKSkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB0aGlzLm1vdmllRGF0YSA9IHsKICAgICAgICB0aXRsZTogbnVsbCwKICAgICAgICByZWxlYXNlX2RhdGU6IG51bGwsCiAgICAgICAgaW1hZ2U6IG51bGwsCiAgICAgICAgYWN0b3JzOiBbXSwKICAgICAgfTsKICAgIH0KCiAgICB0aGlzLmluaXRpYWxpc2VNb3ZpZUZvcm0oKTsKICB9LAogIGNvbXBvbmVudHM6IHsKICAgIEJGb3JtLAogICAgQkZvcm1JbnB1dCwKICAgIEJGb3JtRGF0ZXBpY2tlciwKICAgIE11bHRpc2VsZWN0LAogICAgTG9hZGluZ0FuaW1hdGlvbiwKICB9LAogIGNvbXB1dGVkOiB7CiAgICBwYWdlVGl0bGUoKSB7CiAgICAgIGlmICh0aGlzLmlzTG9hZGluZykgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfSBlbHNlIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgJiYgIXRoaXMuaXNMb2FkaW5nICYmIHRoaXMubW92aWVEYXRhKSB7CiAgICAgICAgcmV0dXJuICJFZGl0ICIgKyB0aGlzLm1vdmllRGF0YS50aXRsZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIk5ldyBNb3ZpZSI7CiAgICAgIH0KICAgIH0sCiAgICBzdWJtaXRUZXh0KCkgewogICAgICBsZXQgYnV0dG9uVGV4dDsKICAgICAgc3dpdGNoICh0aGlzLiRyb3V0ZS5uYW1lKSB7CiAgICAgICAgY2FzZSAiYXBwX21vdmllc19uZXciOgogICAgICAgICAgdGhpcy5zYXZpbmcKICAgICAgICAgICAgPyAoYnV0dG9uVGV4dCA9ICJBZGRpbmcgTW92aWUiKQogICAgICAgICAgICA6IChidXR0b25UZXh0ID0gIlNhdmUgTW92aWUiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImFwcF9tb3ZpZXNfZWRpdCI6CiAgICAgICAgICB0aGlzLnNhdmluZwogICAgICAgICAgICA/IChidXR0b25UZXh0ID0gIlVwZGF0aW5nIE1vdmllIikKICAgICAgICAgICAgOiAoYnV0dG9uVGV4dCA9ICJVcGRhdGUgTW92aWUiKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHJldHVybiBidXR0b25UZXh0OwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIGhhbmRsZUNhbmNlbENsaWNrKCkgewogICAgICBpZiAoaGlzdG9yeS5sZW5ndGgpIHsKICAgICAgICBoaXN0b3J5LmdvKC0xKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiAiYXBwX21vdmllc192aWV3IiwKICAgICAgICAgIHBhcmFtczogeyBpZDogdGhpcy5tb3ZpZURhdGEuaWQgfSwKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiAiYXBwX21vdmllc19saXN0IiwKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGluaXRpYWxpc2VNb3ZpZUZvcm0oKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaWYgKHRoaXMuJHJvdXRlLm5hbWUuc3RhcnRzV2l0aCgiYXBwX21vdmllc19lZGl0IikpIHsKICAgICAgICB0aGlzLmxvYWRNb3ZpZSgpOwogICAgICB9CiAgICAgIHRoaXMubG9hZEFjdG9ycygpOwogICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgfSwKICAgIGFzeW5jIGxvYWRBY3RvcnMoKSB7CiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLmFjdG9ycygpLmdldEFsbCgtMSk7CiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7CiAgICAgICAgdGhpcy5hY3RvcnMgPSByZXNwb25zZS5kYXRhOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZXJyb3IgPSAiRmFpbGVkIHRvIGxvYWQgYWN0b3JzIjsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGxvYWRNb3ZpZSgpIHsKICAgICAgY29uc29sZS5sb2coImZldGNoaW5nIG1vdmllIik7CiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQXBpU2VydmljZS5nZXRJbnN0YW5jZSgpCiAgICAgICAgLm1vdmllcygpCiAgICAgICAgLmdldCh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpOwogICAgICBpZiAocmVzcG9uc2Uuc3VjY2VzcykgewogICAgICAgIGNvbnN0IG1vdmllRGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgdGhpcy5zZWxlY3RlZEFjdG9ycyA9IG1vdmllRGF0YS5jYXN0OwogICAgICAgIG1vdmllRGF0YS5hY3RvcnMgPSBbXTsKICAgICAgICBtb3ZpZURhdGEuY2FzdC5mb3JFYWNoKCh2KSA9PiB7CiAgICAgICAgICBtb3ZpZURhdGEuYWN0b3JzLnB1c2godi5pZCk7CiAgICAgICAgfSk7CiAgICAgICAgbW92aWVEYXRhLmNhc3QgPSBbXTsKICAgICAgICAvLyBtb3ZpZURhdGEuY2FzdC5yZW1vdmUoKTsKICAgICAgICB0aGlzLm1vdmllRGF0YSA9IG1vdmllRGF0YTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVycm9yID0gIkZhaWxlZCB0byBsb2FkIG1vdmllIjsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIHNhdmVNb3ZpZSgpIHsKICAgICAgdGhpcy5zYXZpbmcgPSB0cnVlOwoKICAgICAgbGV0IHJlc3BvbnNlOwoKICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgIHJlc3BvbnNlID0gYXdhaXQgQXBpU2VydmljZS5nZXRJbnN0YW5jZSgpCiAgICAgICAgICAubW92aWVzKCkKICAgICAgICAgIC51cGRhdGUodGhpcy4kcm91dGUucGFyYW1zLmlkLCB0aGlzLm1vdmllRGF0YSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBBcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkKICAgICAgICAgIC5tb3ZpZXMoKQogICAgICAgICAgLmNyZWF0ZSh0aGlzLm1vdmllRGF0YSk7CiAgICAgIH0KCiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7CiAgICAgICAgYXdhaXQgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAiYXBwX21vdmllc19saXN0IiB9KTsKICAgICAgICB0aGlzLmVycm9yID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkKSB7CiAgICAgICAgICB0aGlzLmVycm9yID0gIkVycm9yIHdoZW4gdXBkYXRpbmcgYWN0b3IiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmVycm9yID0gIkVycm9yIHdoZW4gc2F2aW5nIGFjdG9yIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuc2F2aW5nID0gZmFsc2U7CiAgICAgIH0sIDIwMDApOwogICAgfSwKICAgIGFkZEFjdG9yKGUpIHsKICAgICAgY29uc29sZS5sb2coInNlbGVjdGlvbiIsIGUuaWQpOwogICAgICB0aGlzLm1vdmllRGF0YS5hY3RvcnMucHVzaChlLmlkKTsKICAgIH0sCiAgICByZW1vdmVBY3RvcihlKSB7CiAgICAgIGNvbnNvbGUubG9nKCJyZW1vdmUiLCBlLmlkKTsKICAgICAgdGhpcy5tb3ZpZURhdGEuYWN0b3JzID0gdGhpcy5tb3ZpZURhdGEuYWN0b3JzLmZpbHRlcigodikgPT4gdiAhPT0gZS5pZCk7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["MovieSingle.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8EA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MovieSingle.vue","sourceRoot":"src/components/movies","sourcesContent":["<template>\n  <div>\n    <template v-if=\"isLoading\">\n      <LoadingAnimation />\n    </template>\n    <template v-else-if=\"error\">\n      <div class=\"alert alert-warning\">\n        {{ error }}\n      </div>\n    </template>\n    <template v-else>\n      <div>\n        <router-link\n          class=\"btn btn-sm btn-outline-secondary me-4\"\n          :to=\"{ name: 'app_movies_list' }\"\n        >\n          <i class=\"bi-arrow-left\"></i> Back to Movies\n        </router-link>\n      </div>\n      <div class=\"d-flex align-items-center py-4 border-bottom\">\n        <h3 class=\"mb-0 me-4\">{{ pageTitle }}</h3>\n      </div>\n      <div class=\"mt-2\">\n        <BForm>\n          <div class=\"row\">\n            <div class=\"col col-4\">\n              <label class=\"form-label\">Movie Title</label>\n              <BFormInput v-model=\"movieData.title\"></BFormInput>\n            </div>\n            <div class=\"col col-3\">\n              <label class=\"form-label\">Movie Release Date</label>\n              <BFormDatepicker\n                class=\"form-control\"\n                v-model=\"movieData.release_date\"\n              ></BFormDatepicker>\n            </div>\n          </div>\n          <div class=\"row mt-3 mb-4\">\n            <div class=\"col col-4\">\n              <label class=\"form-label\">Movie Cast</label>\n              <Multiselect\n                style=\"min-width: 350px\"\n                v-model=\"selectedActors\"\n                placeholder=\"Select cast members\"\n                :options=\"actors\"\n                :multiple=\"true\"\n                :searchable=\"true\"\n                @select=\"addActor\"\n                @remove=\"removeActor\"\n                track-by=\"id\"\n                label=\"name\"\n              />\n            </div>\n            <div class=\"col col-4\">\n              <label class=\"form-label\">Movie Poster Link</label>\n              <BFormInput\n                v-model=\"movieData.image\"\n                placeholder=\"http://...\"\n              ></BFormInput>\n            </div>\n          </div>\n\n          <button class=\"btn btn-primary mt-3\" @click.prevent=\"saveMovie\">\n            <span>{{ submitText }}</span>\n          </button>\n\n          <button\n            class=\"btn btn-outline-secondary mt-3 ms-3\"\n            @click.prevent=\"handleCancelClick\"\n          >\n            Cancel\n          </button>\n        </BForm>\n      </div>\n    </template>\n  </div>\n</template>\n<script>\nimport { BForm, BFormDatepicker, BFormInput } from \"bootstrap-vue\";\nimport { ApiService } from \"@/api\";\nimport Multiselect from \"vue-multiselect\";\nimport { LoadingAnimation } from \"@/components/shared\";\n\nexport default {\n  name: \"MovieSingle\",\n  data() {\n    return {\n      movieData: null,\n      actors: [],\n      isLoading: true,\n      error: null,\n      selectedActors: [],\n    };\n  },\n  created() {\n    if (this.$route.name.startsWith(\"app_movies_new\")) {\n      this.isLoading = false;\n      this.movieData = {\n        title: null,\n        release_date: null,\n        image: null,\n        actors: [],\n      };\n    }\n\n    this.initialiseMovieForm();\n  },\n  components: {\n    BForm,\n    BFormInput,\n    BFormDatepicker,\n    Multiselect,\n    LoadingAnimation,\n  },\n  computed: {\n    pageTitle() {\n      if (this.isLoading) {\n        return \"\";\n      } else if (this.$route.params.id && !this.isLoading && this.movieData) {\n        return \"Edit \" + this.movieData.title;\n      } else {\n        return \"New Movie\";\n      }\n    },\n    submitText() {\n      let buttonText;\n      switch (this.$route.name) {\n        case \"app_movies_new\":\n          this.saving\n            ? (buttonText = \"Adding Movie\")\n            : (buttonText = \"Save Movie\");\n          break;\n        case \"app_movies_edit\":\n          this.saving\n            ? (buttonText = \"Updating Movie\")\n            : (buttonText = \"Update Movie\");\n          break;\n      }\n      return buttonText;\n    },\n  },\n  methods: {\n    handleCancelClick() {\n      if (history.length) {\n        history.go(-1);\n      } else if (this.$route.params.id) {\n        this.$router.push({\n          name: \"app_movies_view\",\n          params: { id: this.movieData.id },\n        });\n      } else {\n        this.$router.push({\n          name: \"app_movies_list\",\n        });\n      }\n    },\n    initialiseMovieForm() {\n      this.isLoading = true;\n      if (this.$route.name.startsWith(\"app_movies_edit\")) {\n        this.loadMovie();\n      }\n      this.loadActors();\n      this.isLoading = false;\n    },\n    async loadActors() {\n      const response = await ApiService.getInstance().actors().getAll(-1);\n      if (response.success) {\n        this.actors = response.data;\n      } else {\n        this.error = \"Failed to load actors\";\n      }\n    },\n    async loadMovie() {\n      console.log(\"fetching movie\");\n      const response = await ApiService.getInstance()\n        .movies()\n        .get(this.$route.params.id);\n      if (response.success) {\n        const movieData = response.data;\n        this.selectedActors = movieData.cast;\n        movieData.actors = [];\n        movieData.cast.forEach((v) => {\n          movieData.actors.push(v.id);\n        });\n        movieData.cast = [];\n        // movieData.cast.remove();\n        this.movieData = movieData;\n      } else {\n        this.error = \"Failed to load movie\";\n      }\n    },\n    async saveMovie() {\n      this.saving = true;\n\n      let response;\n\n      if (this.$route.params.id) {\n        response = await ApiService.getInstance()\n          .movies()\n          .update(this.$route.params.id, this.movieData);\n      } else {\n        response = await ApiService.getInstance()\n          .movies()\n          .create(this.movieData);\n      }\n\n      if (response.success) {\n        await this.$router.push({ name: \"app_movies_list\" });\n        this.error = null;\n      } else {\n        if (this.$route.params.id) {\n          this.error = \"Error when updating actor\";\n        } else {\n          this.error = \"Error when saving actor\";\n        }\n      }\n\n      setTimeout(() => {\n        this.saving = false;\n      }, 2000);\n    },\n    addActor(e) {\n      console.log(\"selection\", e.id);\n      this.movieData.actors.push(e.id);\n    },\n    removeActor(e) {\n      console.log(\"remove\", e.id);\n      this.movieData.actors = this.movieData.actors.filter((v) => v !== e.id);\n    },\n  },\n};\n</script>\n"]}]}
{"remainingRequest":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/steven/workspace/casting-agency-frontend/src/components/security/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/steven/workspace/casting-agency-frontend/src/components/security/Login.vue","mtime":1655027057236},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-plugin-babel/node_modules/cache-loader/dist/cjs.js","mtime":1618407608009},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/babel-loader/lib/index.js","mtime":1650889791270},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":1618407608009},{"path":"/home/steven/workspace/casting-agency-frontend/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1634219578329}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBib290c3RyYXAgZnJvbSAiYm9vdHN0cmFwIjsKCmNvbnN0IHBvcG92ZXJUcmlnZ2VyTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoCiAgJ1tkYXRhLWJzLXRvZ2dsZT0icG9wb3ZlciJdJwopOwpbLi4ucG9wb3ZlclRyaWdnZXJMaXN0XS5tYXAoCiAgKHBvcG92ZXJUcmlnZ2VyRWwpID0+IG5ldyBib290c3RyYXAuUG9wb3Zlcihwb3BvdmVyVHJpZ2dlckVsKQopOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJMb2dpbiIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGFjY2Vzc1Rva2VuOiBudWxsLAogICAgICBpc1Nob3dDcmVkczogdHJ1ZSwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgaXNBdXRoZW50aWNhdGVkKCkgewogICAgICByZXR1cm4gdGhpcy4kYXV0aC5pc0F1dGhlbnRpY2F0ZWQ7CiAgICB9LAogICAgZXJyb3IoKSB7CiAgICAgIHJldHVybiB0aGlzLiRhdXRoLmVycm9yOwogICAgfSwKICB9LAogIHdhdGNoOiB7CiAgICBpc0F1dGhlbnRpY2F0ZWQ6IHsKICAgICAgYXN5bmMgaGFuZGxlcih2YWwpIHsKICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZVJlZnJlc2goKTsKICAgICAgICB9CiAgICAgIH0sCiAgICB9LAogICAgZXJyb3I6IHsKICAgICAgYXN5bmMgaGFuZGxlcih2YWwpIHsKICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICBhd2FpdCB0aGlzLiRhdXRoLmxvZ291dCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgfSwKICB9LAogIGFzeW5jIGNyZWF0ZWQoKSB7CiAgICAvLyBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oImp3dCIpICYmIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJwZXJtaXNzaW9ucyIpKSB7CiAgICAvLyAgIGNvbnN0IHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImp3dCIpOwogICAgLy8gICBjb25zdCBwZXJtaXNzaW9ucyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJwZXJtaXNzaW9ucyIpOwogICAgLy8gICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0QWNjZXNzVG9rZW4iLCB0b2tlbik7CiAgICAvLyAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZXRBdXRoUGVybWlzc2lvbnMiLCBwZXJtaXNzaW9ucyk7CiAgICAvLyAgIGF3YWl0IHRoaXMuJHJvdXRlci5wdXNoKHsgbmFtZTogImFwcF9kYXNoYm9hcmQiIH0pOwogICAgLy8gfQogIH0sCiAgbWV0aG9kczogewogICAgLy8gTG9nIHRoZSB1c2VyIGluCiAgICBhc3luYyBoYW5kbGVSZWZyZXNoKCkgewogICAgICBhd2FpdCB0aGlzLmdldFRva2VuKCk7CiAgICAgIGF3YWl0IHRoaXMuaGFuZGxlUmVkaXJlY3QoKTsKICAgIH0sCiAgICBhc3luYyBoYW5kbGVSZWRpcmVjdCgpIHsKICAgICAgY29uc3QgcmVsb2FkZWRQYXRoID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1siZ2V0UmVsb2FkZWRQYXRoIl07CiAgICAgIGlmIChyZWxvYWRlZFBhdGggJiYgcmVsb2FkZWRQYXRoICE9PSAiLyIpIHsKICAgICAgICBhd2FpdCB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6IHJlbG9hZGVkUGF0aCB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhd2FpdCB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICJhcHBfZGFzaGJvYXJkIiB9KTsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0SXNSZWxvYWRlZCIsIGZhbHNlKTsKICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInNldFJlbG9hZGVkUGF0aCIsIG51bGwpOwogICAgfSwKICAgIGFzeW5jIGxvZ2luKCkgewogICAgICBhd2FpdCB0aGlzLiRhdXRoLmxvZ2luV2l0aFJlZGlyZWN0KCk7CiAgICAgIGF3YWl0IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgYXdhaXQgdGhpcy5oYW5kbGVSZWRpcmVjdCgpOwogICAgfSwKICAgIGFzeW5jIGdldFRva2VuKCkgewogICAgICBsZXQgdG9rZW47CiAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiand0IikgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oInBlcm1pc3Npb25zIikpIHsKICAgICAgICB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJqd3QiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2tlbiA9IGF3YWl0IHRoaXMuJGF1dGguZ2V0VG9rZW5TaWxlbnRseSgpOwogICAgICAgIGNvbnN0IGp3dCA9IHsKICAgICAgICAgIHZhbHVlOiB0b2tlbiwKICAgICAgICAgIGV4cGlyeTogRGF0ZS5ub3cgKyA4NjQwMDAwMCwKICAgICAgICB9OwogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJqd3QiLCBKU09OLnN0cmluZ2lmeShqd3QpKTsKICAgICAgfQogICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IHRoaXMuJGp3dERlYy5kZWNvZGUodG9rZW4pLnBlcm1pc3Npb25zOwogICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgic2V0QWNjZXNzVG9rZW4iLCB0b2tlbik7CiAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJzZXRBdXRoUGVybWlzc2lvbnMiLCBwZXJtaXNzaW9ucyk7CiAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSB0b2tlbjsKICAgICAgYXdhaXQgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAiYXBwX2Rhc2hib2FyZCIgfSk7CiAgICB9LAogICAgLy8gTG9nIHRoZSB1c2VyIG91dAogICAgbG9nb3V0KCkgewogICAgICB0aGlzLiRhdXRoLmxvZ291dCh7CiAgICAgICAgcmV0dXJuVG86IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sCiAgICAgIH0pOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2JA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/components/security","sourcesContent":["<template>\n  <section\n    class=\"h-100 w-100 position-absolute bg-light py-5\"\n    style=\"left: 0; top: 0; overflow: auto\"\n  >\n    <div\n      class=\"w-100 d-flex justify-content-center align-items-center\"\n      style=\"min-height: 100%\"\n    >\n      <div class=\"card p-4 shadow-sm\">\n        <div\n          class=\"card-body d-flex align-items-center justify-content-center flex-column\"\n        >\n          <h2 class=\"fs-3\" v-if=\"!$auth.loading\">Casting Agency Login</h2>\n          <div v-if=\"!$auth.loading\">\n            <p\n              v-if=\"!$auth.isAuthenticated\"\n              class=\"text-secondary text-center\"\n              style=\"font-size: 13px\"\n            >\n              Please click the button below to login\n            </p>\n            <p\n              v-if=\"$auth.isAuthenticated\"\n              class=\"text-secondary text-center\"\n              style=\"font-size: 13px\"\n            >\n              You are logged in! <br />\n              Click the button below to logout.\n            </p>\n          </div>\n          <div>\n            <!-- show login when not authenticated -->\n            <div class=\"w-100 d-flex justify-content-center\">\n              <button\n                class=\"btn btn-lg btn-primary mt-4\"\n                v-if=\"!$auth.isAuthenticated && !$auth.loading\"\n                @click=\"login\"\n                :disabled=\"$auth.loading\"\n              >\n                <span>Log in</span>\n              </button>\n              <span v-if=\"$auth.loading\">\n                Loading\n                <span\n                  class=\"spinner-border ms-2\"\n                  style=\"width: 1.2rem; height: 1.2rem\"\n                  role=\"status\"\n                ></span>\n              </span>\n              <!-- show logout when authenticated -->\n              <button\n                class=\"btn btn-lg btn-primary mt-4\"\n                v-if=\"$auth.isAuthenticated\"\n                @click=\"logout\"\n              >\n                Log out\n              </button>\n            </div>\n\n            <div\n              class=\"mt-5 text-center\"\n              v-if=\"!$auth.isAuthenticated && !$auth.loading\"\n            >\n              <div class=\"pb-3 border-bottom\">\n                <button\n                  class=\"btn btn-secondary btn-sm\"\n                  @click=\"isShowCreds = !isShowCreds\"\n                >\n                  <span v-if=\"!isShowCreds\">Show Credentials</span\n                  ><span v-if=\"isShowCreds\">Hide Credentials</span>\n                </button>\n              </div>\n              <div class=\"p-2\" v-if=\"isShowCreds\">\n                <h4 class=\"mt-3 mb-3 pb-3\">Login Credentials:</h4>\n                <div class=\"border-bottom\">\n                  <h5>Casting Assistant:</h5>\n                  <span\n                    class=\"badge d-inline-block text-dark bg-light border mt-2 mb-2\"\n                    style=\"font-size: 14px; transform: translateY(-3px)\"\n                    v-b-popover.hover.top=\"\n                      'list:movies, list:actors, view:movies, view:actors'\n                    \"\n                    title=\"Permissions\"\n                    >See Permissions +</span\n                  >\n                  <p>\n                    Username: manager@gmail.com<br />\n                    Password: manager@123\n                  </p>\n                </div>\n                <div class=\"border-bottom pt-3 pb-3\">\n                  <h5>Casting Director:</h5>\n                  <span\n                    class=\"badge d-inline-block text-dark bg-light border mt-2 mb-2\"\n                    style=\"font-size: 14px; transform: translateY(-3px)\"\n                    v-b-popover.hover.top=\"\n                      'list:movies, list:actors, view:movies, view:actors, edit:actors, edit:movies, add:actors, delete:actors'\n                    \"\n                    title=\"Permissions\"\n                    >See Permissions +</span\n                  >\n                  <p>\n                    Username: director@gmail.com<br />\n                    Password: director@123\n                  </p>\n                </div>\n                <div class=\"pb-3 pt-3 pb-3\">\n                  <h5>Executive Producer:</h5>\n                  <span\n                    class=\"badge d-inline-block text-dark bg-light border mt-2 mb-2\"\n                    style=\"font-size: 14px; transform: translateY(-3px)\"\n                    v-b-popover.hover.top=\"\n                      'list:movies, list:actors, view:movies, view:actors, edit:actors, edit:movies, add:actors, add:movies, delete:actors, delete:movies'\n                    \"\n                    title=\"Permissions\"\n                    >See Permissions +</span\n                  >\n                  <p>\n                    Username: executive@gmail.com<br />\n                    Password: executive@123\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div\n              v-if=\"$auth.isAuthenticated\"\n              class=\"w-100 d-flex justify-content-center\"\n            >\n              <button\n                class=\"btn btn-sm btn-outline-secondary mt-4\"\n                @click=\"getToken\"\n                :disabled=\"accessToken\"\n              >\n                <span v-if=\"accessToken\">Token Saved!</span>\n                <span v-else>Get Token</span>\n              </button>\n              <router-link\n                v-if=\"accessToken\"\n                class=\"btn-primary btn mt-2\"\n                :to=\"{ name: 'app_dashboard' }\"\n                >App Dashboard\n              </router-link>\n            </div>\n          </div>\n          <div v-if=\"$auth.error\">\n            {{ $auth.error }}\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n<script>\nimport bootstrap from \"bootstrap\";\n\nconst popoverTriggerList = document.querySelectorAll(\n  '[data-bs-toggle=\"popover\"]'\n);\n[...popoverTriggerList].map(\n  (popoverTriggerEl) => new bootstrap.Popover(popoverTriggerEl)\n);\n\nexport default {\n  name: \"Login\",\n  data() {\n    return {\n      accessToken: null,\n      isShowCreds: true,\n    };\n  },\n  computed: {\n    isAuthenticated() {\n      return this.$auth.isAuthenticated;\n    },\n    error() {\n      return this.$auth.error;\n    },\n  },\n  watch: {\n    isAuthenticated: {\n      async handler(val) {\n        if (val) {\n          await this.handleRefresh();\n        }\n      },\n    },\n    error: {\n      async handler(val) {\n        if (val) {\n          await this.$auth.logout();\n        }\n      },\n      immediate: true,\n    },\n  },\n  async created() {\n    // if (localStorage.getItem(\"jwt\") && localStorage.getItem(\"permissions\")) {\n    //   const token = localStorage.getItem(\"jwt\");\n    //   const permissions = localStorage.getItem(\"permissions\");\n    //   await this.$store.dispatch(\"setAccessToken\", token);\n    //   await this.$store.dispatch(\"setAuthPermissions\", permissions);\n    //   await this.$router.push({ name: \"app_dashboard\" });\n    // }\n  },\n  methods: {\n    // Log the user in\n    async handleRefresh() {\n      await this.getToken();\n      await this.handleRedirect();\n    },\n    async handleRedirect() {\n      const reloadedPath = this.$store.getters[\"getReloadedPath\"];\n      if (reloadedPath && reloadedPath !== \"/\") {\n        await this.$router.push({ path: reloadedPath });\n      } else {\n        await this.$router.push({ name: \"app_dashboard\" });\n      }\n      await this.$store.dispatch(\"setIsReloaded\", false);\n      await this.$store.dispatch(\"setReloadedPath\", null);\n    },\n    async login() {\n      await this.$auth.loginWithRedirect();\n      await this.getToken();\n      await this.handleRedirect();\n    },\n    async getToken() {\n      let token;\n      if (localStorage.getItem(\"jwt\") && localStorage.getItem(\"permissions\")) {\n        token = localStorage.getItem(\"jwt\");\n      } else {\n        token = await this.$auth.getTokenSilently();\n        const jwt = {\n          value: token,\n          expiry: Date.now + 86400000,\n        };\n        localStorage.setItem(\"jwt\", JSON.stringify(jwt));\n      }\n      const permissions = this.$jwtDec.decode(token).permissions;\n      await this.$store.dispatch(\"setAccessToken\", token);\n      await this.$store.dispatch(\"setAuthPermissions\", permissions);\n      this.accessToken = token;\n      await this.$router.push({ name: \"app_dashboard\" });\n    },\n    // Log the user out\n    logout() {\n      this.$auth.logout({\n        returnTo: window.location.origin,\n      });\n    },\n  },\n};\n</script>\n"]}]}